<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>StudyWITH</title>
        <link rel="icon" href="../swithlogo.png" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
        <link rel="stylesheet" href="/public/css/signUp.css" />
        <!-- Axios -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <!-- modal -->
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


        <script>
            var uploadedFile = "";

            /* ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬ */
            function checkID( obj ){
                axios({
                    method: "post",
                    url: "http://localhost:8000/user/signup/isId", // routes/index.js íŒŒì¼ì˜ ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬ path ì„¤ì •
                    data: {
                        user_id: obj.value,
                    }
                }).then((rep) => {
                    return rep.data;
                }).then((data) => {
                    console.log(data);
                    // dataëŠ” signupControllerì—ì„œ true, false í˜•ì‹ìœ¼ë¡œ ë³´ë‚¸ë‹¤.
                    if ( data ) { // dataê°€ trueì´ë©´ ì‹¤í–‰
                        $("#checkID_text").css("color", "green"); // idê°€ checkID_text ì¸ íƒœê·¸ css ì„¤ì •
                        $("#checkID_text").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤."); // idê°€ checkID_text ì¸ íƒœê·¸ í…ìŠ¤íŠ¸ ë³€ê²½
                        $( "button" ).removeAttr("disabled") // ë²„íŠ¼ì˜ disabled ì†ì„±ì„ ì œê±°, disabled: í´ë¦­í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ëŠ” ì†ì„±
                    } else { // dataê°€ falseì´ë©´ ì‹¤í–‰
                        $("#checkID_text").css("color", "red");
                        $("#checkID_text").text("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
                        $( "button" ).attr("disabled", "true");
                    }
                });
            }
            
            /* ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ */
            function checkNickname( obj ) {
                axios({
                    method: "post",
                    url: "http://localhost:8000/user/signup/isName",
                    data: {
                        user_name: obj.value,
                    }
                }).then((req) => { 
                    return req.data;
                }).then((data) => {
                    console.log(data);
                    if ( data ) {
                        $("#checkNickname_text").css("color", "green");
                        $("#checkNickname_text").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
                        $( "button" ).removeAttr("disabled")
                    } else {
                        $("#checkNickname_text").css("color", "red");
                        $("#checkNickname_text").text("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
                        $( "button" ).attr("disabled", "true");
                    }
                });
            }

            /* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ */
            function pwCheck() {
                if(document.getElementById('pw').value !='' && document.getElementById('pwConfirm').value!=''){
                    if(document.getElementById('pw').value==document.getElementById('pwConfirm').value){
                        document.getElementById('check').innerHTML='ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ğŸ¥°'
                        document.getElementById('check').style.color='rgb(54, 54, 255)';
                    }
                    else{
                        document.getElementById('check').innerHTML='ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
                        document.getElementById('check').style.color='rgb(255, 89, 89)';
                    }
                }
            }

            /* íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ*/
            function signup() {
                var form = document.getElementById("signup_form");

                var flag = checkData(); // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬

                if (flag == true ) {
                    axios({
                        method:'post',
                        url: "http://localhost:8000/user/signup",
                        data: {
                            user_id: form.id.value,
                            user_name: form.nickname.value,
                            user_password: form.password.value,
                            hint: form.hint.value,
                            hint_answer: form.hintanswer.value,
                            user_email: form.email.value,
                            user_image: uploadedFile,
                            category1: form.firstField.value,
                            category2: form.secondField.value,
                            category3: form.thirdField.value
                            }
                    })
                    .then((req) => { return req.data;})
                    .then((data) => {
                        document.location.href="http://localhost:8000/user/login";
                    })        
                }  
            }

            /* ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ì‹œ í˜ì´ì§€ ì´ë™*/
            function user_login() {
                document.location.href="http://localhost:8000/user/login";
            }

            /* í”„ë¡œí•„ ì‚¬ì§„ ë“±ë¡ */
            function uploadFile( obj ){
                var formData = new FormData();
                formData.append("name", uploadedFile);
                formData.append('profileImg', obj.files[0]);

                axios({
                    method:'post',
                    url: "http://localhost:8000/user/signup/upload",
                    data: formData,
                })
                .then((req) => { return req.data;})
                .then((data) => {
                    uploadedFile = data.fileName;
                    $("#uploadedProfile").css({"background-image":`url(/public/user/${data.fileName})`}); 
                    $("#uploadedProfile").css({"background-size":`70px 70px`}); 
                })
            }

            /* ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬*/
            function checkData () {
                var form = document.getElementById("signup_form");

                if (form.id.value == '') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                        text: '20ê¸€ì ì´ë‚´',
                    })
                    return false;
                }

                if (form.nickname.value == '' ) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ë‚™ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                        text: '6ê¸€ì ì´ë‚´',
                    })
                    return false;
                }

                if (form.password.value == '') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                        text: '45ê¸€ì ì´ë‚´',
                    })
                    return false;
                }

                if (form.checkPw.value == '') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸í•´ì£¼ì„¸ìš”!',
                        text: '45ê¸€ì ì´ë‚´',
                    })
                    return false;
                }

                if (form.checkPw.value == '') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸í•´ì£¼ì„¸ìš”!',
                        text: '45ê¸€ì ì´ë‚´',
                    })
                    return false;
                }

                if (form.hintanswer.value == '') {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ë¹„ë°€ë²ˆí˜¸ ì§ˆë¬¸ì˜ ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!',
                        text: '50ê¸€ì ì´ë‚´',
                    })
                    return false;
                }

                if ( !form.email.value.includes('@') ) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.',
                        text: '45ê¸€ì ì´ë‚´',
                    })
                    return false;
                }
            }
        </script>
    </head>

    <body>
        <div class="container">

            <img src="/public/login/login_image.png" class="signup_background">
            <!-- <div class="siginup_main"> -->
                
                
                <!-- <div id="form_container"> -->
                    <form id="signup_form">
                        <div id="form_background"></div>
                        
                        <div class="user_info">

                            <img src="/public/login/logo.png" width="300px;" class="signup_logo">

                                <div class="profile" id="img_upload">
                                    <div id="uploadedProfile">
                                        <input type="file" id="profileImg" style="display: none;" name="profileImg" onchange="uploadFile(this);">
                                    </div> 
                                </div>

                                <br><br><br>
                                <span class="profile_span">í”„ë¡œí•„ ë“±ë¡ ğŸ“¸</span>   

                                <br><br><br>

                                <span class="span_field">íšŒì›ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!</span><br><br>
                                
                                <input type="text" name="id" placeholder="ì•„ì´ë””" onkeyup="checkID( this );" class="userid" style="color:white" maxlength='20' required>
                                <br>
                                <p id="checkID_text"></p>

                                <br><br>
        
                                <input type="text" name="nickname" placeholder="ë‹‰ë„¤ì„" onkeyup="checkNickname( this );" class="nickname" style="color:white" maxlength='6' required/>
                                <p id="checkNickname_text"></p>

                                <br><br>
        
                                <input type="text" name="email" placeholder="ì´ë©”ì¼" class="email"/><br><br>

                                <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" onchange="pwCheck()" id="pw" style="color:white" /><br><br>
                                <input type="password" name ="checkPw" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" onchange="pwCheck()" id="pwConfirm" style="color:white" /><br>
                                <span id="check"></span>
                                
                                <br><br><br>
        
                                <span class="span_field">ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸ ì§ˆë¬¸</span><br><br>
                                    <select name="hint" class="category_hint" style="color:rgb(200, 200, 200)">
                                        <option value="1">ì–´ëŠ ì¤‘í•™êµ ì¶œì‹ ì¸ê°€ìš”?</option>
                                        <option value="2">ì¢Œìš°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</option>
                                        <option value="3">í•™ì°½ì‹œì ˆì— ì¢‹ì•„í–ˆë˜ ê³¼ëª©ì€ ë¬´ì—‡ì¸ê°€ìš”?</option>
                                    </select>

                                <br><br>
        
                                <input type="text" name="hintanswer" placeholder="ë¹„ë°€ë²ˆí˜¸ íŒíŠ¸ ë‹µ" class="pwAnswer" style="color:white" />
        
                                <br><br><br>
        
                                <span class="span_field">ê´€ì‹¬ë¶„ì•¼</span><br><br>
                                    <!-- <div class="first">1ìˆœìœ„ -->
                                            <select name="firstField" class="category">
                                                <option value="ì»´í“¨í„°/IT">ì»´í“¨í„°/IT</option>
                                                <option value="ì–¸ì–´">ì–¸ì–´</option>
                                                <option value="ìê²©ì¦">ìê²©ì¦</option>
                                                <option value="ì¸ì¦">ì¸ì¦</option>
                                                <option value="ì·¨ì—…/ì´ì§">ì·¨ì—…/ì´ì§</option>
                                                <option value="ê³µëª¨ì „">ê³µëª¨ì „</option>
                                                <option value="ì·¨ë¯¸">ì·¨ë¯¸</option>
                                            </select>
                                    <!-- </div> -->
        
                                    <br><br>
        
                                    <!-- <div class="second">2ìˆœìœ„ -->
                                            <select name="secondField" class="category">
                                                <option value="ì»´í“¨í„°/IT">ì»´í“¨í„°/IT</option>
                                                <option value="ì–¸ì–´">ì–¸ì–´</option>
                                                <option value="ìê²©ì¦">ìê²©ì¦</option>
                                                <option value="ì¸ì¦">ì¸ì¦</option>
                                                <option value="ì·¨ì—…/ì´ì§">ì·¨ì—…/ì´ì§</option>
                                                <option value="ê³µëª¨ì „">ê³µëª¨ì „</option>
                                                <option value="ì·¨ë¯¸">ì·¨ë¯¸</option>
                                            </select>
                                    <!-- </div> -->
        
                                    <br><br>
        
                                    <!-- <div class="third">3ìˆœìœ„ -->
                                            <select name="thirdField" class="category">
                                                <option value="ì»´í“¨í„°/IT">ì»´í“¨í„°/IT</option>
                                                <option value="ì–¸ì–´">ì–¸ì–´</option>
                                                <option value="ìê²©ì¦">ìê²©ì¦</option>
                                                <option value="ì¸ì¦">ì¸ì¦</option>
                                                <option value="ì·¨ì—…/ì´ì§">ì·¨ì—…/ì´ì§</option>
                                                <option value="ê³µëª¨ì „">ê³µëª¨ì „</option>
                                                <option value="ì·¨ë¯¸">ì·¨ë¯¸</option>
                                            </select>
                                    <!-- </div> -->
        
                                    <!-- <br><br><br><br> -->

                                    <br><br>
                                    <div class="warningDiv"></div>
                                    <br><br>
        
                                    <button type="button" class="signupBtn" style="color:#FFE19C" onclick="signup();">íšŒì›ê°€ì…</button>
                                    
                                    <br><br><br>
                                            
                                    <a href="javascript:void(0);"onclick="user_login(); return false;">
                                        <span>ì´ë¯¸ ìŠ¤ìœ—ì´ì‹ ê°€ìš”?</span>
                                        <span class="span_login">ë¡œê·¸ì¸</span>
                                        <span>í•˜ëŸ¬ê°€ê¸°</span>
                                    </a>
                                </div>
                                <!-- <div class="userLogin"> -->
                                <!-- </div> -->

                            </div>
                        </form>
                    </div>
            </div>
        </div>

        <script>
            $("#uploadedProfile").click(function(e){
                e.preventDefault();
                $("#profileImg").click();
            });
            $("input[type=file]").on("click", function(e){
                 e.stopPropagation();
            });
        </script>
    </body>
</html>